<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>Telegram Login</title>
</head>
<body style="text-align:center; padding-top:100px; font-family:Arial">

<h1>Telegram orqali kirish</h1>

<div style="margin-top:40px">

    <script async src="https://telegram.org/js/telegram-widget.js?22"
            data-telegram-login="loginViaTelegramBot"
            data-size="large"
            data-onauth="onTelegramAuth(user)"
            data-request-access="write">
    </script>

</div>

<script>
    function onTelegramAuth(user) {

        fetch("http://localhost:8080/api/auth/telegram", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(user)
        })
            .then(res => res.json())
            .then(res => {
                if (res.success) {
                    alert("Xush kelibsiz, " + user.first_name + "!");
                    console.log(res);
                } else {
                    alert("Xato: " + res.error);
                }
            })
            .catch(err => {
                alert("Backendga ulanib boâ€˜lmadi");
                console.error(err);
            });
    }
</script>

</body>
</html>
